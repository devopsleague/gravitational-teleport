sets Deployment annotations when specified:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      annotations:
        kubernetes.io/deployment: test-annotation
        kubernetes.io/deployment-different: 3
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 6045ed8277bab581c5bad34950f3f4c81a2bab38d5be0cf7fc74fd3533e63ae6
            kubernetes.io/pod: test-annotation
            kubernetes.io/pod-different: 4
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: RELEASE-NAME
sets Pod annotations when specified:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      annotations:
        kubernetes.io/deployment: test-annotation
        kubernetes.io/deployment-different: 3
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 6045ed8277bab581c5bad34950f3f4c81a2bab38d5be0cf7fc74fd3533e63ae6
            kubernetes.io/pod: test-annotation
            kubernetes.io/pod-different: 4
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: RELEASE-NAME
should add PersistentVolumeClaim as volume when in standalone mode:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 395cea98cb5233f209cf32386f8c1f5c6a3623136c65b2681510b4be5d895d91
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: RELEASE-NAME
should add emptyDir for data in AWS mode:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 3
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 0a7f068250f0bd71bbb352ac774963cce743ee71846f54b86322e6655f4d1fb0
          labels:
            app: RELEASE-NAME
        spec:
          affinity:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
              - podAffinityTerm:
                  labelSelector:
                    matchExpressions:
                    - key: app
                      operator: In
                      values:
                      - RELEASE-NAME
                  topologyKey: kubernetes.io/hostname
                weight: 50
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - emptyDir: {}
            name: data
should add emptyDir for data in GCP mode:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 3
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 5fad7b1c01d561b879dfe9984ee31c77e6510753275da691e8f4d6f87a579c6e
          labels:
            app: RELEASE-NAME
        spec:
          affinity:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
              - podAffinityTerm:
                  labelSelector:
                    matchExpressions:
                    - key: app
                      operator: In
                      values:
                      - RELEASE-NAME
                  topologyKey: kubernetes.io/hostname
                weight: 50
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport-secrets
              name: gcp-credentials
              readOnly: true
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - emptyDir: {}
            name: data
should add emptyDir for data in custom mode:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - emptyDir: {}
            name: data
should add insecureSkipProxyTLSVerify to args when set in values:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 395cea98cb5233f209cf32386f8c1f5c6a3623136c65b2681510b4be5d895d91
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            - --insecure
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: RELEASE-NAME
should add named PersistentVolumeClaim as volume when in standalone mode and standalone.existingClaimName is set:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 6efd4d04ad9b30bef9f5b9cd80b54fbbfe3ad4b0f17cd59c7758ab34490c0f5f
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: teleport-storage
should do enterprise things when when enterprise is set in values:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 6cb0c42403985b41a0b79ae9f51fd5608d4433bfe39617c55b42af77bdbd707c
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport-ent:8.3.4
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /var/lib/license
              name: license
              readOnly: true
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: license
            secret:
              secretName: license
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: RELEASE-NAME
should expose diag port:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 395cea98cb5233f209cf32386f8c1f5c6a3623136c65b2681510b4be5d895d91
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: RELEASE-NAME
should have multiple replicas when replicaCount is set:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 3
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
          labels:
            app: RELEASE-NAME
        spec:
          affinity:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
              - podAffinityTerm:
                  labelSelector:
                    matchExpressions:
                    - key: app
                      operator: In
                      values:
                      - RELEASE-NAME
                  topologyKey: kubernetes.io/hostname
                weight: 50
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - emptyDir: {}
            name: data
should mount ConfigMap for config in AWS mode:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 3
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 0a7f068250f0bd71bbb352ac774963cce743ee71846f54b86322e6655f4d1fb0
          labels:
            app: RELEASE-NAME
        spec:
          affinity:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
              - podAffinityTerm:
                  labelSelector:
                    matchExpressions:
                    - key: app
                      operator: In
                      values:
                      - RELEASE-NAME
                  topologyKey: kubernetes.io/hostname
                weight: 50
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - emptyDir: {}
            name: data
should mount ConfigMap for config in GCP mode:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 3
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 5fad7b1c01d561b879dfe9984ee31c77e6510753275da691e8f4d6f87a579c6e
          labels:
            app: RELEASE-NAME
        spec:
          affinity:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
              - podAffinityTerm:
                  labelSelector:
                    matchExpressions:
                    - key: app
                      operator: In
                      values:
                      - RELEASE-NAME
                  topologyKey: kubernetes.io/hostname
                weight: 50
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport-secrets
              name: gcp-credentials
              readOnly: true
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - emptyDir: {}
            name: data
should mount ConfigMap for config in custom mode:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - emptyDir: {}
            name: data
should mount ConfigMap for config in standalone mode:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 395cea98cb5233f209cf32386f8c1f5c6a3623136c65b2681510b4be5d895d91
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: RELEASE-NAME
should mount GCP credentials for initContainer in GCP mode:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 3
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 2922ec300952c084aed753fac5b9d88be765b5e6f22cf2dedc5f6a6dd51f3fa5
          labels:
            app: RELEASE-NAME
        spec:
          affinity:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
              - podAffinityTerm:
                  labelSelector:
                    matchExpressions:
                    - key: app
                      operator: In
                      values:
                      - RELEASE-NAME
                  topologyKey: kubernetes.io/hostname
                weight: 50
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport-secrets
              name: gcp-credentials
              readOnly: true
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          initContainers:
          - args:
            - echo test
            image: alpine
            name: teleport-init
            volumeMounts:
            - mountPath: /etc/teleport-secrets
              name: gcp-credentials
              readOnly: true
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - emptyDir: {}
            name: data
should mount GCP credentials in GCP mode:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 3
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 5fad7b1c01d561b879dfe9984ee31c77e6510753275da691e8f4d6f87a579c6e
          labels:
            app: RELEASE-NAME
        spec:
          affinity:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
              - podAffinityTerm:
                  labelSelector:
                    matchExpressions:
                    - key: app
                      operator: In
                      values:
                      - RELEASE-NAME
                  topologyKey: kubernetes.io/hostname
                weight: 50
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport-secrets
              name: gcp-credentials
              readOnly: true
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - emptyDir: {}
            name: data
should mount TLS certs for initContainer when cert-manager is enabled:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 3
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 3403b033cb54772aef4cdd5cf55b55b0e73c25b0cda44517bcf97c2288b6f7a6
          labels:
            app: RELEASE-NAME
        spec:
          affinity:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
              - podAffinityTerm:
                  labelSelector:
                    matchExpressions:
                    - key: app
                      operator: In
                      values:
                      - RELEASE-NAME
                  topologyKey: kubernetes.io/hostname
                weight: 50
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport-secrets
              name: gcp-credentials
              readOnly: true
            - mountPath: /etc/teleport-tls
              name: teleport-tls
              readOnly: true
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          initContainers:
          - args:
            - echo test
            image: alpine
            name: teleport-init
            volumeMounts:
            - mountPath: /etc/teleport-secrets
              name: gcp-credentials
              readOnly: true
            - mountPath: /etc/teleport-tls
              name: teleport-tls
              readOnly: true
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - name: teleport-tls
            secret:
              secretName: teleport-tls
          - configMap:
              name: RELEASE-NAME
            name: config
          - emptyDir: {}
            name: data
should mount TLS certs when cert-manager is enabled:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 3
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 7cff9523c08601b0b1c835385d709f2080a3ff088bff7359adb939f5846c216c
          labels:
            app: RELEASE-NAME
        spec:
          affinity:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
              - podAffinityTerm:
                  labelSelector:
                    matchExpressions:
                    - key: app
                      operator: In
                      values:
                      - RELEASE-NAME
                  topologyKey: kubernetes.io/hostname
                weight: 50
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport-secrets
              name: gcp-credentials
              readOnly: true
            - mountPath: /etc/teleport-tls
              name: teleport-tls
              readOnly: true
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - name: teleport-tls
            secret:
              secretName: teleport-tls
          - configMap:
              name: RELEASE-NAME
            name: config
          - emptyDir: {}
            name: data
should mount extraVolumes and extraVolumeMounts:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: f0db5061f7a85e6a1971a3e3380d106fbc24bda6a4910b95cfd3289528cd3a39
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
            - mountPath: /path/to/mount
              name: my-mount
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: RELEASE-NAME
          - name: my-mount
            secret:
              secretName: mySecret
should not do enterprise things when when enterprise is not set in values:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: f0db5061f7a85e6a1971a3e3380d106fbc24bda6a4910b95cfd3289528cd3a39
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:8.3.4
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: RELEASE-NAME
should not have more than one replica in standalone mode:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 395cea98cb5233f209cf32386f8c1f5c6a3623136c65b2681510b4be5d895d91
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: RELEASE-NAME
should provision initContainer correctly when set in values:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: f0db5061f7a85e6a1971a3e3380d106fbc24bda6a4910b95cfd3289528cd3a39
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            env:
            - name: SSL_CERT_FILE
              value: /etc/tls/some-cert-file.pem
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            resources:
              limits:
                cpu: 2
                memory: 4Gi
              requests:
                cpu: 1
                memory: 2Gi
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          initContainers:
          - args:
            - echo test
            image: alpine
            name: teleport-init
            resources:
              limits:
                cpu: 2
                memory: 4Gi
              requests:
                cpu: 1
                memory: 2Gi
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: RELEASE-NAME
should set affinity when set in values:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 3
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
          labels:
            app: RELEASE-NAME
        spec:
          affinity:
            nodeAffinity:
              requiredDuringSchedulingIgnoredDuringExecution:
                nodeSelectorTerms:
                - matchExpressions:
                  - key: gravitational.io/dedicated
                    operator: In
                    values:
                    - teleport
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - emptyDir: {}
            name: data
should set environment when extraEnv set in values:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 395cea98cb5233f209cf32386f8c1f5c6a3623136c65b2681510b4be5d895d91
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            env:
            - name: SSL_CERT_FILE
              value: /etc/tls/some-cert-file.pem
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: RELEASE-NAME
should set imagePullPolicy when set in values:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 395cea98cb5233f209cf32386f8c1f5c6a3623136c65b2681510b4be5d895d91
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: Always
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: RELEASE-NAME
should set postStart command if set in values:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 395cea98cb5233f209cf32386f8c1f5c6a3623136c65b2681510b4be5d895d91
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            lifecycle:
              postStart:
                exec:
                  command:
                  - /bin/echo
                  - test
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: RELEASE-NAME
should set priorityClassName when set in values:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: f0db5061f7a85e6a1971a3e3380d106fbc24bda6a4910b95cfd3289528cd3a39
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          priorityClassName: system-cluster-critical
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: RELEASE-NAME
should set required affinity when highAvailability.requireAntiAffinity is set:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 3
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: 0a7f068250f0bd71bbb352ac774963cce743ee71846f54b86322e6655f4d1fb0
          labels:
            app: RELEASE-NAME
        spec:
          affinity:
            podAntiAffinity:
              requiredDuringSchedulingIgnoredDuringExecution:
              - labelSelector:
                  matchExpressions:
                  - key: app
                    operator: In
                    values:
                    - RELEASE-NAME
                topologyKey: kubernetes.io/hostname
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - emptyDir: {}
            name: data
should set resources when set in values:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: f0db5061f7a85e6a1971a3e3380d106fbc24bda6a4910b95cfd3289528cd3a39
          labels:
            app: RELEASE-NAME
        spec:
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            resources:
              limits:
                cpu: 2
                memory: 4Gi
              requests:
                cpu: 1
                memory: 2Gi
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - name: data
            persistentVolumeClaim:
              claimName: RELEASE-NAME
should set tolerations when set in values:
  1: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: RELEASE-NAME
      name: RELEASE-NAME
      namespace: NAMESPACE
    spec:
      replicas: 3
      selector:
        matchLabels:
          app: RELEASE-NAME
      template:
        metadata:
          annotations:
            checksum/config: dbd160b76055da63471092ecb42c879932eee5cd10aceed3a069ce1cb97f57c9
          labels:
            app: RELEASE-NAME
        spec:
          affinity:
            podAntiAffinity:
              preferredDuringSchedulingIgnoredDuringExecution:
              - podAffinityTerm:
                  labelSelector:
                    matchExpressions:
                    - key: app
                      operator: In
                      values:
                      - RELEASE-NAME
                  topologyKey: kubernetes.io/hostname
                weight: 50
          containers:
          - args:
            - --diag-addr=0.0.0.0:3000
            image: quay.io/gravitational/teleport:10.0.0-dev
            imagePullPolicy: IfNotPresent
            livenessProbe:
              failureThreshold: 6
              httpGet:
                path: /healthz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            name: teleport
            ports:
            - containerPort: 3000
              name: diag
              protocol: TCP
            readinessProbe:
              failureThreshold: 12
              httpGet:
                path: /readyz
                port: diag
              initialDelaySeconds: 5
              periodSeconds: 5
            volumeMounts:
            - mountPath: /etc/teleport
              name: config
              readOnly: true
            - mountPath: /var/lib/teleport
              name: data
          serviceAccountName: RELEASE-NAME
          tolerations:
          - effect: NoExecute
            key: dedicated
            operator: Equal
            value: teleport
          - effect: NoSchedule
            key: dedicated
            operator: Equal
            value: teleport
          volumes:
          - name: gcp-credentials
            secret:
              secretName: teleport-gcp-credentials
          - configMap:
              name: RELEASE-NAME
            name: config
          - emptyDir: {}
            name: data
